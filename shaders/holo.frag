#include <flutter/runtime_effect.glsl>

uniform vec2 uSize;  // Размер области рисования
uniform float uTime; // Время для анимации

out vec4 fragColor; // Итоговый цвет пикселя

// Функция для создания красивой радужной палитры (cosine palette)
// Источник: https://iquilezles.org/articles/palettes/
vec3 palette(float t) {
    vec3 a = vec3(0.5, 0.5, 0.5);
    vec3 b = vec3(0.5, 0.5, 0.5);
    vec3 c = vec3(1.0, 1.0, 1.0);
    vec3 d = vec3(0.263, 0.416, 0.557); // Эти числа создают приятный радужный спектр
    return a + b * cos(6.28318 * (c * t + d));
}

void main() {
    // Нормализуем координаты пикселя от 0.0 до 1.0
    vec2 uv = FlutterFragCoord().xy / uSize;

    // Создаем диагональное движение.
    // uv.x + uv.y создает диагональный градиент.
    // Вычитаем время, чтобы он двигался.
    // Умножаем на числа, чтобы настроить угол и скорость.
    float movement = uv.x * 0.7 + uv.y * 0.5 - uTime * 0.3;

    // 1. Генерация "блеска" (интенсивности света)
    // Используем синус для создания полос.
    float shine = sin(movement * 10.0); // 10.0 - плотность полос
    // Делаем полосы более узкими и резкими (металлическими)
    shine = smoothstep(0.3, 0.9, shine);

    // 2. Генерация цвета
    // Используем то же движение для плавного смена цвета по палитре
    vec3 rainbowColor = palette(movement * 0.4);

    // Комбинируем: яркий блеск имеет радужный цвет
    vec3 finalColor = shine * rainbowColor;

    // Итоговый цвет.
    // Альфа-канал (прозрачность) зависит от интенсивности блеска.
    // Чем ярче блеск, тем менее прозрачен пиксель.
    // Умножаем на 0.5, чтобы эффект не был слишком пересвеченным,
    // и базовая карта проглядывала снизу.
    fragColor = vec4(finalColor, shine * 0.5);
}